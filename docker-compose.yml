#version: "3.8"

services:
  netprobe:
    build: ./probe
    # image: bmmbmm01/netprobe:latest   # use this instead of build when pushing to Docker Hub
    container_name: netprobe
    restart: unless-stopped

    env_file:
      - ./probe/config.env

    environment:
      # Web UI port (inside container)
      WEB_PORT: ${WEB_PORT:-8080}

      # Site target list (limit ~5 sites / domains)
      SITES: ${SITES:-fast.com,google.com,youtube.com,amazon.com}

      # DNS test site
      DNS_TEST_SITE: ${DNS_TEST_SITE:-google.com}

      # DNS name servers (4 slots, last typically your home DNS)
      DNS_NAMESERVER_1: ${DNS_NAMESERVER_1:-Google_DNS}
      DNS_NAMESERVER_1_IP: ${DNS_NAMESERVER_1_IP:-8.8.8.8}
      DNS_NAMESERVER_2: ${DNS_NAMESERVER_2:-Quad9_DNS}
      DNS_NAMESERVER_2_IP: ${DNS_NAMESERVER_2_IP:-9.9.9.9}
      DNS_NAMESERVER_3: ${DNS_NAMESERVER_3:-CloudFlare_DNS}
      DNS_NAMESERVER_3_IP: ${DNS_NAMESERVER_3_IP:-1.1.1.1}
      DNS_NAMESERVER_4: ${DNS_NAMESERVER_4:-My_DNS_Server}
      DNS_NAMESERVER_4_IP: ${DNS_NAMESERVER_4_IP:-192.168.1.1}

      # Health Score Weights (should sum to 1.0)
      WEIGHT_LOSS: ${WEIGHT_LOSS:-0.6}
      WEIGHT_LATENCY: ${WEIGHT_LATENCY:-0.15}
      WEIGHT_JITTER: ${WEIGHT_JITTER:-0.2}
      WEIGHT_DNS_LATENCY: ${WEIGHT_DNS_LATENCY:-0.05}

      # Health Score Thresholds
      THRESHOLD_LOSS: ${THRESHOLD_LOSS:-5}
      THRESHOLD_LATENCY: ${THRESHOLD_LATENCY:-100}
      THRESHOLD_JITTER: ${THRESHOLD_JITTER:-30}
      THRESHOLD_DNS_LATENCY: ${THRESHOLD_DNS_LATENCY:-100}

      # Speedtest configuration
      SPEEDTEST_ENABLED: ${SPEEDTEST_ENABLED:-True}
      SPEEDTEST_INTERVAL: ${SPEEDTEST_INTERVAL:-14400}

    ports:
      - "${WEB_PORT:-8080}:${WEB_PORT:-8080}"

    volumes:
      - netprobe_data:/data

volumes:
  netprobe_data:
